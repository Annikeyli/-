#include <iostream>
using namespace std;

class Interpolation {
private:
    double* x_nodes;  
    double* y_nodes;  
    int n;           

public:
    Interpolation(double* x, double* y, int node_count) {
        n = node_count - 1;  
        x_nodes = new double[node_count];
        y_nodes = new double[node_count];
        
        for (int i = 0; i <= n; i++) {
            x_nodes[i] = x[i];
            y_nodes[i] = y[i];
        }
    }
    
    ~Interpolation() {
        delete[] x_nodes;
        delete[] y_nodes;
    }

    // Вычисление разделенных разностей 
    double dividedDifference(int start, int end) {        
        if (start == end) return y_nodes[start];
        // f(x_i; x_i+1; ...; x_i+k) = (f(x_i+1; ...; x_i+k) - f(x_i; ...; x_i+k-1)) / (x_i+k - x_i)
        return (dividedDifference(start + 1, end) - dividedDifference(start, end - 1)) / (x_nodes[end] - x_nodes[start]);
    }

    //// Вычисление по формуле Ньютона: Pₙ(x) = y₀ + f(x₀;x₁)(x-x₀) + f(x₀;x₁;x₂)(x-x₀)(x-x₁) + ... + f(x₀;x₁;...;xₙ)(x-x₀)...(x-xₙ₋₁)
    //double interpolate(double x) {
    //    double result = y_nodes[0]; // Начинаем с y0 
    //    double pt = 1.0;  // (x-x0)(x-x1)...(x-xn-1)
    //    for (int k = 1; k <= n; k++) {
    //        pt *= (x - x_nodes[k - 1]);
    //        result += dividedDifference(0, k) * pt;
    //    }
    //    return result;
    //}

    void printInfo() {
        cout << "\nDivided differences:" << endl;
        cout << "  f(x0;x1) = " << dividedDifference(0, 1) << endl;
        cout << "  f(x0;x1;x2) = " << dividedDifference(0, 2) << endl;
        cout << "  f(x0;x1;x2;x3) = " << dividedDifference(0, 3) << endl;
           
        cout << "\nP3(x) = " << y_nodes[0] << " + " << dividedDifference(0, 1) << "(x - " << x_nodes[0] << ") + " << dividedDifference(0,2) << "(x - " << x_nodes[0] << ")(x - " << x_nodes[1] << ") + " << dividedDifference(0, 3) << "(x - " << x_nodes[0] << ")(x - " << x_nodes[1] << ")(x - " << x_nodes[2] << ")" << endl;
    }
};

int main() {
    cout << "\n1: y = x^3 - 2x\n";
    double x1[] = { 0.0, 1.0, 2.0, 3.0 };
    double y1[] = { 0.0, -1.0, 4.0, 21.0 };
    int nodes1 = 4;

    Interpolation interp1(x1, y1, nodes1);
    interp1.printInfo();

    /*cout << "\nInterpolation results:" << endl;
    for (double x = 0.0; x <= 3.0; x += 0.5) {
        double y = interp1.interpolate(x);
        cout << "  P(" << x << ") = " << y << endl;
    }*/
        
    cout << "\n\n2:\n";
    double x2[] = { 1.0, 5.0, 7.0, 11.0 };
    double y2[] = { 3.0, 4.0, 6.0, 12.0 };
    int nodes2 = 4;

    Interpolation interp2(x2, y2, nodes2);
    interp2.printInfo();

    /*cout << "\nInterpolation results:" << endl;
    for (double x = 1.0; x <= 11.0; x += 1.0) {
        double y = interp2.interpolate(x);
        cout << "  P(" << x << ") = " << y << endl;
    }*/

    return 0;
}


