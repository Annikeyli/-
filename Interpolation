#include <iostream>
using namespace std;

class Interpolation {
private:
    double* x_nodes;  // Массив узлов x₀, x₁, ..., xₙ (должны быть упорядочены: x₀ < x₁ < ... < xₙ)
    double* y_nodes;  // Массив значений функции в узлах y₀, y₁, ..., yₙ
    int n;           // Количество интервалов (количество узлов = n + 1)

public:
    // Конструктор: создает интерполятор по заданным узлам
    Interpolation(double* x, double* y, int node_count) {
        // Сохраняем данные
        n = node_count - 1;  
        x_nodes = new double[node_count];
        y_nodes = new double[node_count];

        // Копируем узлы интерполяции
        for (int i = 0; i <= n; i++) {
            x_nodes[i] = x[i];
            y_nodes[i] = y[i];
        }
    }
    // Деструктор: освобождаем память
    ~Interpolation() {
        delete[] x_nodes;
        delete[] y_nodes;
    }

    // Вычисляем значение функции в точке x по формуле Ф(x) = yᵢ + (yᵢ₊₁ - yᵢ)/(xᵢ₊₁ - xᵢ) * (x - xᵢ)   
    double interpolate(double x) {
        // Ищем интервал [xᵢ, xᵢ₊₁], в который попадает x
        for (int i = 0; i < n; i++) {
            // Проверяем, попадает ли x в текущий интервал [xᵢ, xᵢ₊₁]
            if (x >= x_nodes[i] && x <= x_nodes[i + 1]) {  
                double x_i = x_nodes[i];      // xᵢ - левая граница интервала
                double x_i1 = x_nodes[i + 1];   // xᵢ₊₁ - правая граница интервала
                double y_i = y_nodes[i];      // yᵢ - значение в левой границе
                double y_i1 = y_nodes[i + 1];   // yᵢ₊₁ - значение в правой границе
                                 
                double result = y_i + (y_i1 - y_i) / (x_i1 - x_i) * (x - x_i);

                return result;
            }            
        }
        return 0; 
    }

    // Для вывода информации об интерполяторе
    void printInfo() {
        for (int i = 0; i <= n; i++) {
            cout << "  node " << i << ": (" << x_nodes[i] << ", " << y_nodes[i] << ")" << endl;
        }
    }
};

int main() {
    // ПРИМЕР 1: Линейная функция 
    cout << " EX1: lin func y = 2x + 1" << endl;
    double x1[] = { 0.0, 1.0, 2.0, 3.0 };  // Узлы x₀, x₁, x₂, x₃
    double y1[] = { 1.0, 3.0, 5.0, 7.0 };  // Значения в узлах y₀, y₁, y₂, y₃
    int nodes1 = 4; // Количество узлов

    Interpolation lin_interp(x1, y1, nodes1);
    lin_interp.printInfo();

    cout << "\nresult interpolation:" << endl;    
    for (double x = 0.0; x <= 3.0; x += 1.0) {
        double y = lin_interp.interpolate(x);
        cout << "F(" << x << ") = " << y << endl;
    }

    // ПРИМЕР 2: Произвольная функция
    cout << "\nEX2: proizvol func" << endl;
    double x2[] = { 0.0, 2.0, 3.0, 5.0, 6.0 };
    double y2[] = { 1.0, 4.0, 2.0, 5.0, 3.0 };
    int nodes2 = 5;

    Interpolation custom_interp(x2, y2, nodes2);
    custom_interp.printInfo();

    cout << "\nresult interpolation:" << endl;
    for (double x = 0.0; x <= 6.0; x += 1.0) {
        double y = custom_interp.interpolate(x);
        cout << "F(" << x << ") = " << y << endl;
    }

    return 0;
}
